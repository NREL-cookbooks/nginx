passenger_root <%= node['nginx']['passenger']['root'] %>;
passenger_ruby <%= node['nginx']['passenger']['ruby'] %>;
passenger_max_pool_size <%= node['nginx']['passenger']['max_pool_size'] %>;
passenger_spawn_method <%= node['nginx']['passenger']['spawn_method'] %>;
passenger_buffer_response <%= node['nginx']['passenger']['buffer_response'] %>;
passenger_min_instances <%= node['nginx']['passenger']['min_instances'] %>;
passenger_max_instances_per_app <%= node['nginx']['passenger']['max_instances_per_app'] %>;
passenger_pool_idle_time <%= node['nginx']['passenger']['pool_idle_time'] %>;
passenger_max_requests <%= node['nginx']['passenger']['max_requests'] %>;

# Security
passenger_user_switching <%= if(node[:nginx][:passenger][:user_switching]) then "on" else "off" end %>;
passenger_default_user <%= node[:nginx][:user] %>;
<% if node[:nginx][:passenger][:default_group] -%>
Passenger_default_group <%= node[:nginx][:passenger][:default_group] %>;
<% end -%>
passenger_friendly_error_pages <%= if(node[:nginx][:passenger][:friendly_error_pages]) then "on" else "off" end %>;

# Resource control and optimization
<% if(node[:nginx][:passenger][:version] >= "4") -%>
passenger_max_preloader_idle_time <%= node[:nginx][:passenger][:max_preloader_idle_time] %>;
<% end -%>
<% node[:nginx][:passenger][:pre_start_urls].each do |url| -%>
passenger_pre_start <%= url %>;
<% end -%>

# Logging and debugging
passenger_log_level <%= node[:nginx][:passenger][:log_level] %>;
<% if node[:nginx][:passenger][:debug_log_file] -%>
passenger_debug_log_file <%= node[:nginx][:passenger][:debug_log_file] %>;
<% end -%>

# Ruby on Rails-specific
<% if node[:nginx][:passenger][:rails_base_uri] -%>
passenger_base_uri <%= node[:nginx][:passenger][:rails_base_uri] %>;
<% end -%>
rails_env <%= node[:nginx][:passenger][:rails_env] %>;
<% if(node[:nginx][:passenger][:version] < "4") -%>
rails_framework_spawner_idle_time <%= node[:nginx][:passenger][:rails_framework_spawner_idle_time] %>;
rails_app_spawner_idle_time <%= node[:nginx][:passenger][:rails_app_spawner_idle_time] %>;
<% end -%>

# Rack-specific
<% if node[:nginx][:passenger][:rack_base_uri] -%>
passenger_base_uri <%= node[:nginx][:passenger][:rack_base_uri] %>;
<% end -%>
# rack_env <%= node[:nginx][:passenger][:rack_env] %>;

# Per Cyber Security: Disable showing the specific version of Passenger
# running.
passenger_show_version_in_header off;
